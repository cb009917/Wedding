import{r as f,j as e,S as G,B as p}from"./index-BgticnMs.js";import{C as x}from"./Card-lTKER2nr.js";import"./vendor-Bzgz95E1.js";function P(s,a,o={}){const{maxDistance:r=3,minSimilarity:c=.6,searchFields:u=["fullName","firstName","lastName"]}=o;if(!s||s.trim().length===0)return[];const n=j(s),i=n.length<=2?.8:c,l=[];return a.forEach(d=>{const t=A(n,d,u,r);if(t){const{score:g,matchedField:h,distance:v}=t;g>=i&&l.push({guest:d,score:g,matchedField:h,distance:v})}}),l.sort((d,t)=>t.score-d.score),l}function j(s){return!s||typeof s!="string"?"":s.toLowerCase().trim().replace(/\s+/g," ").replace(/[.,\-']/g,"").normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function N(s,a){if(s===a)return 0;if(s.length===0)return a.length;if(a.length===0)return s.length;let o=0;for(;o<s.length&&o<a.length&&s[o]===a[o];)o++;s=s.slice(o),a=a.slice(o);let r=s.length-1,c=a.length-1;for(;r>=0&&c>=0&&s[r]===a[c];)r--,c--;if(s=s.slice(0,r+1),a=a.slice(0,c+1),s.length===0)return a.length;if(a.length===0)return s.length;const u=s.length,n=a.length,i=new Array(n+1);for(let l=0;l<=n;l++)i[l]=l;for(let l=1;l<=u;l++){let d=l;for(let t=1;t<=n;t++){const g=i[t];s[l-1]===a[t-1]?i[t]=d:i[t]=Math.min(i[t-1]+1,d+1,i[t]+1),d=g}}return i[n]}function T(s,a){if(!s||!a)return 0;const o=N(s,a),r=Math.max(s.length,a.length);return 1-o/r}function A(s,a,o,r=1/0){let c=0,u=null;if(r==null&&(r=1/0),o.forEach(n=>{const i=a[n];if(!i)return;const l=j(i),d=N(s,l);if(typeof r=="number"&&d>r)return;let t=T(s,l);l.includes(s)&&(t=Math.max(t,.85)),l.startsWith(s)&&(t=Math.max(t,.9)),t>c&&(c=t,u=n)}),a.firstName&&a.lastName){const n=j(`${a.firstName} ${a.lastName}`),i=N(s,n);if(typeof r=="number"&&i<=r){let l=T(s,n);n.includes(s)&&(l=Math.max(l,.85)),n.startsWith(s)&&(l=Math.max(l,.9)),l>c&&(c=l,u="fullName")}}if(a.firstName&&a.lastName){const n=j(`${a.lastName} ${a.firstName}`),i=N(s,n);if(typeof r=="number"&&i<=r){let l=T(s,n);n.includes(s)&&(l=Math.max(l,.85)),n.startsWith(s)&&(l=Math.max(l,.9)),l>c&&(c=l,u="fullName")}}if(c>0){let n=null;try{u&&a[u]?n=N(s,j(a[u])):a.firstName&&a.lastName&&(n=N(s,j(`${a.firstName} ${a.lastName}`)))}catch{n=null}return{score:c,matchedField:u,distance:n}}return null}function D({spreadsheetId:s,sheetRange:a="Guests!A1:E",title:o="Find Your Table",subtitle:r="Enter your name to find your table assignment",searchPlaceholder:c="Enter your name...",maxResults:u=5}){const[n,i]=f.useState(""),[l,d]=f.useState(null),[t,g]=f.useState(null),[h,v]=f.useState("idle"),[E,F]=f.useState(null),[L,C]=f.useState(!1),[b,y]=f.useState(null),S=f.useRef(null),w=f.useCallback(async()=>{{F("Table lookup is not configured. Please contact the wedding organizers."),v("error");return}},[s,a]);f.useEffect(()=>{w()},[w]),f.useEffect(()=>{h==="success"&&S.current?.focus()},[h]);const R=m=>{if(m.preventDefault(),!n||n.trim().length<2||!l||h!=="success")return;y(null);const k=P(n,l,{maxDistance:3,minSimilarity:.6});g(k),C(!0)},W=m=>{i(m.target.value),C(!1),g(null)},M=()=>{i(""),g(null),C(!1),y(null),S.current&&S.current.focus()},$=m=>{y(m)};return e.jsxs(G,{id:"table-lookup",background:"light",padding:"large",children:[e.jsxs("div",{className:"table-lookup-header",children:[e.jsx("h2",{children:o}),e.jsx("p",{children:r})]}),e.jsx("div",{className:"table-lookup-form",children:e.jsx(x,{variant:"elevated",padding:"large",children:e.jsx("form",{onSubmit:R,children:e.jsxs("div",{className:"search-input-group",children:[e.jsx("label",{htmlFor:"guest-search",className:"search-label",children:"Guest Name"}),e.jsx("input",{id:"guest-search",ref:S,type:"text",className:"search-input",value:n,onChange:W,placeholder:c,disabled:h==="loading","aria-label":"Search for your name",autoComplete:"off"}),e.jsx(p,{type:"submit",variant:"primary",disabled:n.trim().length<2||h!=="success",children:h==="loading"?"Loading...":"Find My Table"})]})})})}),h==="loading"&&e.jsxs("div",{className:"table-lookup-loading",children:[e.jsx("div",{className:"loading-spinner","aria-label":"Loading"}),e.jsx("p",{children:"Loading guest list..."})]}),h==="error"&&e.jsx("div",{className:"table-lookup-error",children:e.jsx(x,{padding:"large",children:e.jsxs("div",{className:"error-content",children:[e.jsx("span",{className:"error-icon","aria-hidden":"true",children:"⚠️"}),e.jsx("p",{className:"error-message",children:E}),e.jsx("div",{style:{marginTop:"var(--spacing-md)"},children:e.jsx(p,{variant:"primary",onClick:()=>{v("loading"),w()},children:"Retry"})})]})})}),L&&h==="success"&&e.jsxs("div",{className:"table-lookup-results",role:"region","aria-live":"polite",children:[t&&t.length===0&&e.jsx("div",{className:"no-results",children:e.jsxs(x,{padding:"large",children:[e.jsx("span",{className:"no-results-icon","aria-hidden":"true",children:"🔍"}),e.jsxs("p",{className:"no-results-message",children:[`We couldn't find a match for "`,n,'". Please check the spelling or try a different name.']}),e.jsxs("div",{className:"no-results-suggestions",children:[e.jsx("p",{children:e.jsx("strong",{children:"Suggestions:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Try using your full name"}),e.jsx("li",{children:"Check for typos"}),e.jsx("li",{children:"Contact us if you need assistance"})]})]}),e.jsx(p,{variant:"secondary",onClick:M,children:"Try Again"})]})}),t&&t.length===1&&e.jsx("div",{className:"result-success animate-fade-in-up",children:e.jsxs(x,{variant:"elevated",padding:"large",children:[e.jsx("p",{className:"result-guest-name",children:t[0].guest.fullName}),e.jsxs("div",{className:"result-table",children:[e.jsx("span",{className:"table-label",children:"You're seated at"}),e.jsxs("span",{className:"table-number",children:["Table ",t[0].guest.table]})]}),t[0].guest.guests&&e.jsxs("p",{className:"result-guests",children:["Party of ",t[0].guest.guests]}),e.jsx("p",{className:"result-message",children:"We look forward to celebrating with you!"}),e.jsx(p,{variant:"secondary",onClick:M,children:"Search Again"})]})}),b&&e.jsx("div",{className:"result-success animate-fade-in-up",children:e.jsxs(x,{variant:"elevated",padding:"large",children:[e.jsx("p",{className:"result-guest-name",children:b.guest.fullName}),e.jsxs("div",{className:"result-table",children:[e.jsx("span",{className:"table-label",children:"You're seated at"}),e.jsxs("span",{className:"table-number",children:["Table ",b.guest.table]})]}),b.guest.guests&&e.jsxs("p",{className:"result-guests",children:["Party of ",b.guest.guests]}),e.jsx("p",{className:"result-message",children:"We look forward to celebrating with you!"}),e.jsx(p,{variant:"secondary",onClick:()=>y(null),children:"Back"})]})}),t&&t.length>1&&e.jsxs("div",{className:"multiple-results",children:[e.jsxs("p",{className:"multiple-results-header",children:["We found ",t.length," possible matches. Please select your name:"]}),e.jsx("div",{className:"results-list",children:t.slice(0,u).map((m,k)=>e.jsxs(x,{className:"result-item animate-fade-in-up",style:{animationDelay:`${k*.1}s`},padding:"medium",onClick:()=>$(m),children:[e.jsx("p",{className:"result-item-name",children:m.guest.fullName}),e.jsxs("p",{className:"result-item-table",children:["Table ",m.guest.table]}),m.guest.guests&&e.jsxs("p",{className:"result-item-guests",children:["Party of ",m.guest.guests]})]},k))}),t.length>u&&e.jsxs("p",{className:"results-overflow",children:["Showing first ",u," results. Try a more specific name."]}),e.jsx(p,{variant:"secondary",onClick:M,children:"Search Again"})]})]})]})}export{D as default};
